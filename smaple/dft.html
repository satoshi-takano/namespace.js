<html>
<script type="text/javascript" src="../src/0_lib_define.js"></script>
<script type="text/javascript" src="../src/1_namespace.js"></script>
<script type="text/javascript" src="../src/2_core.js"></script>
<script type="text/javascript" src="../src/3_events.js"></script>
<script type="text/javascript" src="../src/4_geom.js"></script>
<script type="text/javascript" src="../src/5_application.js"></script>
<script type="text/javascript" src="../src/6_tween.js"></script>
<script type="text/javascript" src="../src/7_net.js"></script>
<script type="text/javascript" src="../src/8_display.js"></script>
<script type="text/javascript" src="../src/9_ui.js"></script>
<script type="text/javascript" src="../src/10_native_extention.js"></script>
<script type="text/javascript" src="../src/11_canvas.js"></script>
<script type="text/javascript" src="../src/12_math.js"></script>

<canvas id="canvas" width='500' height='540'>
</canvas>
<script type="text/javascript">

new Namespace(namespace_lib_core).Main.getInstance().main(function (argument) {
	var ns = new Namespace(namespace_lib_canvas)
	var stage = ns.Stage.gen(document.getElementById("canvas"))
	
	var cont = ns.DisplayObjectContainer.gen();
	stage.addChild(cont);
	cont.graphics.beginFill(0);
	cont.graphics.drawRect(0, 0, stage.stageWidth, 500);
	
	new Namespace(namespace_lib_math).Math.sugar();
	var dt = 30;
	var samples = [];
	var real = [];
	var imag = [];
	
	for (var i = 0; i < dt; i++) {
		samples[i] = 0;
		samples[i] += 2 * sin(1 * i * 2 * Math.PI / dt);
		samples[i] += 3 * sin(2 * i * 2 * Math.PI / dt);
		samples[i] += 1 * sin(3 * i * 2 * Math.PI / dt);
	}

	cont.graphics.beginFill(0,0);
	cont.graphics.lineStyle(2, 0xff0000);
	
	var amp = 10;
	cont.graphics.moveTo(0, samples[0] + 500);
	var oldx = 0;
	var oldy = samples[0] + 255;
	for (var i = 0; i < samples.length; i++) {
		var x = i * stage.stageWidth / samples.length;
		var y = samples[i] * amp + 255;
		var cx = oldx + (x - oldx) / 4;
		var cy = oldy + (y - oldy) / 4;
		cont.graphics.curveTo(cx, cy, x, y);
		oldx = x;
		oldy = y;
//		cont.graphics.drawCircle(x, y, 2)
	}
	cont.graphics.endFill();

	var real = [];
	var imag = [];
	DFT(dt, samples, real, imag);
	
	cont.graphics.context.font = "10px Helvetica";
	cont.graphics.lineStyle(0, 0);
	var flg = true;
	for (i = 0; i < samples.length; i++) {
		var r = real[i];
		var j = imag[i];
		var amp = sqrt(r * r + j * j);
//		console.log(i + " Hz : " + (amp + 0.0001));
		x = i * stage.stageWidth / samples.length;
		y = amp;
		
		cont.graphics.beginFill(0x00ff00);
		cont.graphics.drawRect(x, 500 - y, 3, 500 - (500 - y));
		cont.graphics.beginFill(0);
		cont.graphics.drawText(i+"Hz", x - 8, stage.stageHeight - 15 + ((flg = !flg) ? -6 : 6));
	}
	
	stage.draw();
});

</script>
<body>
</body>
</html>

